<modal
  #createUpdateIterationDialog
  [title]="modalTitle"
  [closeOnOutsideClick]="false"
  (onOpen)="actionOnOpen()"
  (onClose)="actionOnClose()"
  (onSubmit)="actionOnSubmit()">
  <modal-content>
    <div *ngIf="modalType=='update' || modalType=='create' || modalType=='createChild'">
      <div class="form-group" 
        [class.has-error]="validationError">
          <label for="iteration-name">
            Name <span class="required-pf">*</span>
          </label>
          <input class="form-control"
            id="iteration-name"
            type="text" 
            placeholder="Iteration Name"
            [(ngModel)]="iteration.name"
            (keyup.enter)="actionOnSubmit()"
            (keyup)="removeError()">
          <span class="error-block"
            [ngClass]="validationError? 'show': 'hide'">
            <small class="help-block">
              {{ validationString }}
            </small>
          </span>
      </div>
      <div class="form-group">
        <label for="parent-iteration">Parent Iteration</label>
        <div class="posRel input-group dropdown open active">
          <input 
            class="form-control"
            id="parent-iteration" 
            type="text" 
            #iterationSearch 
            (keyup)="filterIteration($event)"
            autocomplete="off" 
            [value]="selectedParentIterationName" 
            (focus)="iterationSearchFocus();" 
            [disabled]="iterationSearchDisable">
          <ul class="f8-itr__modal-list dropdown-menu dropdown-ul"
            *ngIf="showIterationDropdown" 
            #iterationList>
            <li *ngIf="!filteredIterations.length"
              (click)="showIterationDropdown = !showIterationDropdown">
                No matches found.
            </li>
            <li id='{{iteration.key}}'
              *ngFor="let iteration of filteredIterations;"
              [attr.data-id]="iteration.key" 
              (click)="setParentIteration(iteration);">
              <span [innerHTML]="(iteration.value) | almSearchHighlight: iterationSearch.value"></span>
            </li>
          </ul>
          <span class="input-group-addon pointer"
            (click)="iterationSearchFocus();">
              <span class="caret"></span>
          </span>
        </div>
      </div>
      <div class="form-group">
        <label for="iteration-description">Description</label>
        <textarea 
          class="form-control"
          id="iteration-description"
          placeholder="Describe this iteration's goals and what it will include."
          rows="3"
          #iterationDesc
          [(ngModel)]="iteration.description">
        </textarea>
      </div>
    </div>
    <div class="form-group f8-itr__datepicker"
      *ngIf="modalType=='create' || modalType=='update' || modalType=='start' || modalType=='createChild'">
      <div class="f8-itr__datepicker-block padding-right-5 dib">
        <label>Start Date</label>
        <my-date-picker
          #startmydp="mydatepicker"
          [options]="startDatePickerOptions"
          (dateChanged)="onStartDateChanged($event)"
          (calendarToggle)="onStartCalendarToggle($event)"
          [(ngModel)]="startDate">
        </my-date-picker>
      </div>
      <div class="f8-itr__datepicker-block padding-left-5 dib">
        <label>End Date</label>
        <my-date-picker
          #endmydp="mydatepicker"
          [options]="endDatePickerOptions"
          (dateChanged)="onEndDateChanged($event)"
          (calendarToggle)="onEndCalendarToggle($event)"
          [(ngModel)]="endDate">
        </my-date-picker>
      </div>
    </div>
    <div style="display: flex"
      *ngIf="modalType=='create' || modalType=='update' || modalType=='createChild'">
      <label class="margin-right-5">
        Force Active:
      </label>
      <switch id="active-switch"
        (onChecked)="onChecked($event)"
        [isChecked]="iteration.userActive">
      </switch>
    </div>
    <div class="form-group f8-itr__datepicker"
      *ngIf="modalType=='close'">
        Do you really want to close this iteration?
    </div>
    <div class="error-block has-error"
      [ngClass]="spaceError ? 'show' : 'hide'">
        <span class="help-block">
          There is already a current iteration. You must close the current 
          iteration before starting this one.
        </span>
    </div>
  </modal-content>
  <modal-footer>
    <button
      class="btn btn-default margin-right-10"
      id="cancel-iteration-button" 
      type="submit"
      value="0"
      [disabled]="submitLoading" 
      (click)="createUpdateIterationDialog.close()">
        Cancel
    </button>
    <button
      class="btn btn-primary"
      id="create-iteration-button"
      type="submit"
      value="0"
      [disabled]="submitLoading"
      (click)="createUpdateIterationDialog.onSubmit.emit(undefined)">
        {{ submitBtnTxt }}
    </button>
  </modal-footer>
</modal>
